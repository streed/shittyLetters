{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block content %}
<div class="container">
  <div class="jumbotron">
    <div class="row">
      <div id="shittyCarousel" class="carousel slide carousel-fade row offset4 span4">
        <div class="carousel-inner">
          <div class="active item"><img src="https://s3.amazonaws.com/gameguin/static/img/Gameguin_logo.png"></div>
          <div class="item"><img src="https://s3.amazonaws.com/gameguin/static/img/games/Gameguin_tf2.png"></div>
          <div class="item"><img src="https://s3.amazonaws.com/gameguin/static/img/games/Gameguin_cs.png"></div>
        </div>
      </div>
    </div>
    <div class="row"> 
      <h2>Does someone deserve one of these postcards?</h2>
      <p class="lead">Then you're in the right place.</p>
    </div>
  </div>
  <div class="row">
      <div class="col-lg-4">
        <div class="form-horizontal postcard-destination-form">
          <fieldset>
            <div class="page-header">
              <h2>Deserving Person</h2>
            </div>
            <div class="control-group">
              <label class="control-label">Full Name</label>
              <div class="controls">
                <input id="full-name" name="full-name" type="text" placeholder="full name"
                                                                   class="input-xlarge">
                <p class="help-block"></p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">Address Line 1</label>
              <div class="controls">
                <input id="address-line1" name="address-line1" type="text" placeholder="address line 1" class="input-xlarge">
                <p class="help-block">Street address, P.O. box, company name, c/o</p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">Address Line 2</label>
              <div class="controls">
                <input id="address-line2" name="address-line2" type="text" placeholder="address line 2" class="input-xlarge">
                <p class="help-block">Apartment, suite , unit, building, floor, etc.</p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">City / Town</label>
              <div class="controls">
                <input id="city" name="city" type="text" placeholder="city" class="input-xlarge">
                <p class="help-block"></p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">State</label>
              <div class="controls">
                <select id="region" name="region" class="form-control col-sm-2">
                  <option value="AL">AL</option>
                  <option value="AK">AK</option>
                  <option value="AZ">AZ</option>
                  <option value="AR">AR</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DE">DE</option>
                  <option value="DC">DC</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="IA">IA</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="ME">ME</option>
                  <option value="MD">MD</option>
                  <option value="MA">MA</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MS">MS</option>
                  <option value="MO">MO</option>
                  <option value="MT">MT</option>
                  <option value="NE">NE</option>
                  <option value="NV">NV</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NY">NY</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VT">VT</option>
                  <option value="VA">VA</option>
                  <option value="WA">WA</option>
                  <option value="WV">WV</option>
                  <option value="WI">WI</option>
                  <option value="WY">WY</option>
                </select>
                <p class="help-block"></p>
              </div>
            </div>
            <!-- postal-code input-->
            <div class="control-group">
              <label class="control-label">Zip / Postal Code</label>
              <div class="controls">
                <input id="postal-code" name="postal-code" type="text" placeholder="zip or postal code" class="input-xlarge">
                <p class="help-block"></p>
              </div>
            </div>
            <button class="btn postcard-submit">Buy Postcard</button>
          </fieldset>
        </div>
      </div>
      <div class="col-lg-8">
        <div class='preview-window'>
          <div class="page-header">
            <h2>Preview</h2>
          </div>
          <div class="postcard-preview">
          </div>
        </div>
        <div class='postcard-buy'>
          <div class="page-header">
            <h2>Purchase</h2>
          </div>
          <div class='col-md-4'>
            <div class='payment-form'>
              <div class='form-row'>
                <div class='col-xs-12 form-group required'>
                  <label class='control-label'>Email to send receipt</label>
                  <input class='form-control email' size='4' type='text' placeholder="Your email address">
                </div>
              </div>
              <div class='form-row'>
                <div class='col-xs-12 form-group required'>
                  <label class='control-label'>Name on Card</label>
                  <input class='form-control name' size='4' type='text' placeholder="Name as appears on card">
                </div>
              </div>
              <div class='form-row'>
                <div class='col-xs-12 form-group card required'>
                  <label class='control-label'>Card Number</label>
                  <input autocomplete='off' class='form-control card-number' size='20' type='text' placeholder="ex 1111222233334444">
                </div>
              </div>
              <div class='form-row'>
                <div class='col-xs-4 form-group cvc required'>
                  <label class='control-label'>CVC</label>
                  <input autocomplete='off' class='form-control card-cvc' placeholder='ex. 311' size='4' type='text'>
                </div>
                <div class='col-xs-4 form-group expiration required'>
                  <label class='control-label'>Expiration</label>
                  <input class='form-control card-expiry-month' placeholder='MM' size='2' type='text'>
                </div>
                <div class='col-xs-4 form-group expiration required'>
                  <label class='control-label'> </label>
                  <input class='form-control card-expiry-year' placeholder='YYYY' size='4' type='text'>
                </div>
              </div>
              <div class='form-row'>
                <div class='col-md-12'>
                  <div class='form-control total btn btn-success'>
                    Total:
                    <span class='amount'>$2.50</span>
                  </div>
                </div>
              </div>
              <div class='form-row'>
                <div class='col-md-12 form-group'>
                  <button class='form-control btn btn-primary submit-button'>Pay »</button>
                </div>
              </div>
              <div class='form-row'>
                <div class='col-md-12 error form-group'>
                  <div class='payment-errors'>
                  </div>
                </div>
              </div>
            </div>
        </div>
        <div class='col-md-4'>
          <p>Thanks for deciding to send some sass. We want to remind you that the message one the post card is random and could be incredibly docile to incredibly offensive, so please keep that in mind. Regardless we cannot and will not be held liable for anyone that may get angry because of our service.
          </p>
          <p>
            As soon as your payment is processed your postcard will be made and mailed out on the next available day that the USPS performs their job, which excludes government holidays and Sundays.
          </p>
        </div>
    </div>
        </div>
      </div>
  </div>
</div>  
{% endblock %}
{% block custom_javascript %}
$(document).ready(function(){
  $('.carousel').carousel();
  $('.postcard-buy').hide();

  Stripe.setPublishableKey('pk_test_ikXDMh2P9wfEH1u8A5qQfFzr');

  $('.postcard-submit').click(function(e){
    e.preventDefault();
    $('.preview-window').hide();
    $('.postcard-buy').show();

    $('.submit-button').click(function(e){
      e.preventDefault();
      $(this).toggleClass('disabled');

      Stripe.card.createToken({
        number: $('.card-number').val(),
        cvc: $('.card-cvc').val(),
        exp_month: $('.card-expiry-month').val(),
        exp_year: $('.card-expiry-year').val(),
        name: $('.name').val()}, stripeResponseHandler);
    });
  });
});

function stripeResponseHandler(status, response) {
  if (response.error) {
   $('.submit-button').toggleClass('disabled');
   $(".payment-errors").html(response.error.message); 
  } else {
    $('.name').val(""); 
    $('.card-number').val("");
    $('.card-cvc').val("");
    $('.card-expiry-month').val("");
    $('.card-expiry-year').val("");
    $(".payment-errors").html(""); 
    var token = response["id"]

    postcardRequest = buildRequest();
    postcardRequest.card_token = token;

    $.ajax({
      type: 'POST',
      url: '/postcard',
      data: JSON.stringify(postcardRequest),
      headers: {
        'Content-Type': 'application/json'
      },
      dataType: 'json',
      success: function(data) {
        console.log(data);
      }
    });
  }
}

function buildRequest() {
  return {
    "full_name": $('#full-name').val(),
    "address1": $('#address-line1').val(),
    "address2": $('#address-line2').val(),
    "city": $('#city').val(),
    "postal_code": $('#postal-code').val(),
    "state": $('#region option:selected').text(),
    "email": $('.email').val()
  }
}

{% endblock %}

